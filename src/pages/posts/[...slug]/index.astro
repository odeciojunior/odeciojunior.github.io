---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import { DEFAULT_LANGUAGE } from "@/i18n/config";
import getSortedPosts from "@/utils/getSortedPosts";

// This is a redirect page for old non-localized post URLs
// Generate paths for all existing posts
export const getStaticPaths = (async () => {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  const sortedPosts = getSortedPosts(posts);
  
  return sortedPosts.map(post => ({
    params: { slug: post.id }
  }));
}) satisfies GetStaticPaths;

// Old blog post URLs redirect to localized versions
const slug = typeof Astro.params.slug === 'string' ? Astro.params.slug : '';
const defaultLocale = DEFAULT_LANGUAGE === 'en-US' ? 'en' : DEFAULT_LANGUAGE === 'pt-BR' ? 'pt' : DEFAULT_LANGUAGE;

return Astro.redirect(`/${defaultLocale}/posts/${slug}/`, 301);
---