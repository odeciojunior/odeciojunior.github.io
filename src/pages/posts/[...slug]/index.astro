---
// Root individual post page - serves English content directly
// With prefixDefaultLocale: false, English content is served from root
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import PostDetails from "@/layouts/PostDetails.astro";
import getSortedPosts from "@/utils/getSortedPosts";

export const getStaticPaths = (async () => {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  const sortedPosts = getSortedPosts(posts);
  
  // Filter for English posts
  const englishPosts = sortedPosts.filter(post => {
    if (post.data.locale) {
      return post.data.locale === 'en-US';
    }
    return true;
  });
  
  const paths = englishPosts.map(post => ({
    params: { 
      slug: post.id 
    },
    props: { post }
  }));
  
  return paths;
}) satisfies GetStaticPaths;


const { post } = Astro.props;
const currentLocale = 'en-US';

// Set current language in Astro.locals
Astro.locals.currentLanguage = currentLocale;

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = getSortedPosts(posts);
---

<PostDetails post={post} posts={sortedPosts} locale={currentLocale} />